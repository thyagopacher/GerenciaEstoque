/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package visao;

import java.util.ArrayList;
import java.util.List;
import javax.swing.JOptionPane;
import negocio.FormaPagamentoRN;
import persistencia.Conexao;
import recursos.utilitarios.Mascara;
import recursos.utilitarios.TableModel;
import vo.FormaPagamento;

/**
 *
 * @author ThyagoHenrique
 */
public class JFFormaPagamento extends javax.swing.JFrame {

     Mascara                  mas                 = new Mascara();
     String                   titulo[]            = new String[]{"Código", "Nome"};
     TableModel               tm                  = new TableModel(titulo, 1, titulo.length);         
     List<FormaPagamento>     obj                 = new ArrayList();
     FormaPagamento           forma               = new FormaPagamento();
     FormaPagamentoRN         frn                 = new FormaPagamentoRN();
     Conexao                  cx;
     /**
      * Creates new form JFFormaPagamento
      */
     public JFFormaPagamento() {
          initComponents();
     }
     
     public JFFormaPagamento(Conexao cx) {
          initComponents();
          this.cx = cx;
          tabela.setModel(tm);
     }
     /**
      * This method is called from within the constructor to initialize the
      * form. WARNING: Do NOT modify this code. The content of this method is
      * always regenerated by the Form Editor.
      */
     @SuppressWarnings("unchecked")
     // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
     private void initComponents() {

          jLabel3 = new javax.swing.JLabel();
          jTabbedPane1 = new javax.swing.JTabbedPane();
          jPanel1 = new javax.swing.JPanel();
          jLabel1 = new javax.swing.JLabel();
          tnome = new javax.swing.JTextField();
          bsair = new javax.swing.JButton();
          bexcluir = new javax.swing.JButton();
          bupdate = new javax.swing.JButton();
          binserir = new javax.swing.JButton();
          jLabel4 = new javax.swing.JLabel();
          tjuro = new javax.swing.JTextField();
          rbfatura1 = new javax.swing.JRadioButton();
          rbfatura2 = new javax.swing.JRadioButton();
          tdias2 = new javax.swing.JTextField();
          tdias1 = new javax.swing.JTextField();
          blimpar = new javax.swing.JButton();
          jLabel5 = new javax.swing.JLabel();
          tadiantamento = new javax.swing.JTextField();
          jPanel2 = new javax.swing.JPanel();
          jLabel2 = new javax.swing.JLabel();
          tnomeproc = new javax.swing.JTextField();
          bprocurar = new javax.swing.JButton();
          jScrollPane1 = new javax.swing.JScrollPane();
          tabela = new javax.swing.JTable();

          jLabel3.setText("jLabel3");

          setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
          setTitle("Formas de Pagamento");

          jLabel1.setText("Nome");

          tnome.setToolTipText("Nome da forma de pagamento");

          bsair.setText("Sair");
          bsair.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    bsairActionPerformed(evt);
               }
          });

          bexcluir.setText("Excluir");
          bexcluir.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    bexcluirActionPerformed(evt);
               }
          });

          bupdate.setText("update");
          bupdate.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    bupdateActionPerformed(evt);
               }
          });

          binserir.setText("Inserir");
          binserir.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    binserirActionPerformed(evt);
               }
          });

          jLabel4.setText("Juros");

          tjuro.setToolTipText("Juros de desconto para a forma de pagamento");

          rbfatura1.setText("Faturamento a cada tantos dias");
          rbfatura1.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    rbfatura1ActionPerformed(evt);
               }
          });

          rbfatura2.setText("Faturamento sempre no dia ");
          rbfatura2.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    rbfatura2ActionPerformed(evt);
               }
          });

          blimpar.setText("Limpar");
          blimpar.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    blimparActionPerformed(evt);
               }
          });

          jLabel5.setText("Juros Adiantamento");

          javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
          jPanel1.setLayout(jPanel1Layout);
          jPanel1Layout.setHorizontalGroup(
               jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel1Layout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                         .addGroup(jPanel1Layout.createSequentialGroup()
                              .addComponent(rbfatura1, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                              .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                              .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                   .addComponent(tdias2, javax.swing.GroupLayout.DEFAULT_SIZE, 65, Short.MAX_VALUE)
                                   .addComponent(tdias1))
                              .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                         .addGroup(jPanel1Layout.createSequentialGroup()
                              .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                   .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addComponent(jLabel1)
                                        .addGap(18, 18, 18)
                                        .addComponent(tnome))
                                   .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                             .addGroup(jPanel1Layout.createSequentialGroup()
                                                  .addComponent(jLabel4)
                                                  .addGap(18, 18, 18)
                                                  .addComponent(tjuro, javax.swing.GroupLayout.PREFERRED_SIZE, 105, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                  .addComponent(jLabel5))
                                             .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                                  .addComponent(rbfatura2)
                                                  .addGap(0, 0, Short.MAX_VALUE)))
                                        .addGap(18, 18, 18)
                                        .addComponent(tadiantamento, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE)))
                              .addContainerGap())))
               .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                    .addContainerGap(58, Short.MAX_VALUE)
                    .addComponent(blimpar)
                    .addGap(18, 18, 18)
                    .addComponent(binserir)
                    .addGap(18, 18, 18)
                    .addComponent(bupdate)
                    .addGap(18, 18, 18)
                    .addComponent(bexcluir)
                    .addGap(18, 18, 18)
                    .addComponent(bsair)
                    .addGap(26, 26, 26))
          );
          jPanel1Layout.setVerticalGroup(
               jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel1Layout.createSequentialGroup()
                    .addGap(19, 19, 19)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(jLabel1)
                         .addComponent(tnome, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGap(18, 18, 18)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(jLabel4)
                         .addComponent(tjuro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addComponent(jLabel5)
                         .addComponent(tadiantamento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(rbfatura1)
                         .addComponent(tdias1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(rbfatura2)
                         .addComponent(tdias2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 65, Short.MAX_VALUE)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(bsair)
                         .addComponent(bexcluir)
                         .addComponent(bupdate)
                         .addComponent(binserir)
                         .addComponent(blimpar))
                    .addGap(43, 43, 43))
          );

          jTabbedPane1.addTab("Cadastro", jPanel1);

          jLabel2.setText("Nome");

          bprocurar.setText("Procurar");
          bprocurar.addActionListener(new java.awt.event.ActionListener() {
               public void actionPerformed(java.awt.event.ActionEvent evt) {
                    bprocurarActionPerformed(evt);
               }
          });

          tabela.setModel(new javax.swing.table.DefaultTableModel(
               new Object [][] {
                    {null, null},
                    {null, null},
                    {null, null},
                    {null, null}
               },
               new String [] {
                    "Código", "Nome"
               }
          ));
          tabela.addMouseListener(new java.awt.event.MouseAdapter() {
               public void mouseClicked(java.awt.event.MouseEvent evt) {
                    tabelaMouseClicked(evt);
               }
          });
          jScrollPane1.setViewportView(tabela);

          javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
          jPanel2.setLayout(jPanel2Layout);
          jPanel2Layout.setHorizontalGroup(
               jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel2Layout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                         .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 443, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addGroup(jPanel2Layout.createSequentialGroup()
                              .addComponent(jLabel2)
                              .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                              .addComponent(tnomeproc, javax.swing.GroupLayout.PREFERRED_SIZE, 253, javax.swing.GroupLayout.PREFERRED_SIZE)
                              .addGap(18, 18, 18)
                              .addComponent(bprocurar)))
                    .addContainerGap(18, Short.MAX_VALUE))
          );
          jPanel2Layout.setVerticalGroup(
               jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(jPanel2Layout.createSequentialGroup()
                    .addGap(15, 15, 15)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                         .addComponent(jLabel2)
                         .addComponent(tnomeproc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addComponent(bprocurar))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 212, Short.MAX_VALUE)
                    .addContainerGap())
          );

          jTabbedPane1.addTab("Procurar", jPanel2);

          javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
          getContentPane().setLayout(layout);
          layout.setHorizontalGroup(
               layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addComponent(jTabbedPane1)
          );
          layout.setVerticalGroup(
               layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addComponent(jTabbedPane1)
          );

          pack();
     }// </editor-fold>//GEN-END:initComponents

     private void bsairActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bsairActionPerformed
          this.dispose();
     }//GEN-LAST:event_bsairActionPerformed

     private void bexcluirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bexcluirActionPerformed
          String msg      = "";
          int    response = JOptionPane.showConfirmDialog(null, "Tem certeza disso,\n"
               + "Você quer excluir?", "Confirmação de excluir:",
               JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE);
          if (response == JOptionPane.YES_OPTION) {
               if(forma != null && forma.getCodigo() != null){
                    msg = frn.excluirFormaPagamento(cx, forma);
               }
          }
          if(msg != null && !msg.isEmpty()){
               JOptionPane.showMessageDialog(null, msg);
          }else{
               obj.remove(forma);
               listar();
               JOptionPane.showMessageDialog(null, "Excluido com sucesso");
          }
     }//GEN-LAST:event_bexcluirActionPerformed

     private void bupdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bupdateActionPerformed
          setaFormaPagamento();
          String msg = frn.updateFormaPagamento(cx, forma);
          if(msg != null && !msg.isEmpty()){
               JOptionPane.showMessageDialog(null, msg);
          }else{
               for(int i = 0; i < obj.size(); i++){
                    if(obj.get(i).getCodigo() == forma.getCodigo()){
                         obj.set(i, forma);
                         listar();
                         break;
                    }
               }
               JOptionPane.showMessageDialog(null, "Atualizado com sucesso");
          }
     }//GEN-LAST:event_bupdateActionPerformed

     private void binserirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_binserirActionPerformed
          forma = new FormaPagamento();
          setaFormaPagamento();
          String msg = frn.inserirFormaPagamento(cx, forma);
          if(msg != null && !msg.isEmpty()){
               JOptionPane.showMessageDialog(null, msg);
          }else{
               obj.add(forma);
               listar();
               JOptionPane.showMessageDialog(null, "Inserido com sucesso");
          }
     }//GEN-LAST:event_binserirActionPerformed

     private void bprocurarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bprocurarActionPerformed
          obj = frn.procuraNomeParcial(cx, tnomeproc.getText());
          if(obj != null && !obj.isEmpty()){
               listar();
          }else{
               JOptionPane.showMessageDialog(null, "Nada encontrado");
          }
     }//GEN-LAST:event_bprocurarActionPerformed

     private void tabelaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tabelaMouseClicked
          forma = obj.get(tabela.getSelectedRow());
          setaTelaForma();
     }//GEN-LAST:event_tabelaMouseClicked

     private void rbfatura2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbfatura2ActionPerformed
          rbfatura1.setSelected(false);
          tdias1.setText("");
          rbfatura2.setSelected(true);
     }//GEN-LAST:event_rbfatura2ActionPerformed

     private void rbfatura1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbfatura1ActionPerformed
          rbfatura2.setSelected(false);
          tdias2.setText("");
          rbfatura1.setSelected(true);
     }//GEN-LAST:event_rbfatura1ActionPerformed

     private void blimparActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_blimparActionPerformed
          tnome.setText("");
          tjuro.setText("");
          tdias1.setText("");
          tdias2.setText("");
          rbfatura1.setSelected(false);
          rbfatura2.setSelected(false);
     }//GEN-LAST:event_blimparActionPerformed

     /**
      * @param args the command line arguments
      */
     public static void main(String args[]) {
          /* Set the Nimbus look and feel */
          //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
           * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
           */
          try {
               for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                    if ("Nimbus".equals(info.getName())) {
                         javax.swing.UIManager.setLookAndFeel(info.getClassName());
                         break;
                    }
               }
          } catch (ClassNotFoundException ex) {
               java.util.logging.Logger.getLogger(JFFormaPagamento.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
          } catch (InstantiationException ex) {
               java.util.logging.Logger.getLogger(JFFormaPagamento.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
          } catch (IllegalAccessException ex) {
               java.util.logging.Logger.getLogger(JFFormaPagamento.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
          } catch (javax.swing.UnsupportedLookAndFeelException ex) {
               java.util.logging.Logger.getLogger(JFFormaPagamento.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
          }
          //</editor-fold>

          /* Create and display the form */
          java.awt.EventQueue.invokeLater(new Runnable() {
               @Override
               public void run() {
                    new JFFormaPagamento().setVisible(true);
               }
          });
     }
     // Variables declaration - do not modify//GEN-BEGIN:variables
     private javax.swing.JButton bupdate;
     private javax.swing.JButton bexcluir;
     private javax.swing.JButton binserir;
     private javax.swing.JButton blimpar;
     private javax.swing.JButton bprocurar;
     private javax.swing.JButton bsair;
     private javax.swing.JLabel jLabel1;
     private javax.swing.JLabel jLabel2;
     private javax.swing.JLabel jLabel3;
     private javax.swing.JLabel jLabel4;
     private javax.swing.JLabel jLabel5;
     private javax.swing.JPanel jPanel1;
     private javax.swing.JPanel jPanel2;
     private javax.swing.JScrollPane jScrollPane1;
     private javax.swing.JTabbedPane jTabbedPane1;
     private javax.swing.JRadioButton rbfatura1;
     private javax.swing.JRadioButton rbfatura2;
     private javax.swing.JTable tabela;
     private javax.swing.JTextField tadiantamento;
     private javax.swing.JTextField tdias1;
     private javax.swing.JTextField tdias2;
     private javax.swing.JTextField tjuro;
     private javax.swing.JTextField tnome;
     private javax.swing.JTextField tnomeproc;
     // End of variables declaration//GEN-END:variables

    private void listar() {
            tabela.setModel(new TableModel(titulo, obj.size(), titulo.length));
            for(int i=0; i < obj.size(); i++){
                    tabela.setValueAt(obj.get(i).getCodigo(), i, 0);
                    tabela.setValueAt(obj.get(i).getNome().toUpperCase(), i, 1);
            }
            tabela.setAutoCreateRowSorter(true);    
    }  

     private void setaTelaForma() {
          tnome.setText(forma.getNome().toUpperCase());
          if(forma.getFormafaturamento() != null){
               if(forma.getFormafaturamento().equals("A CADA TANTOS DIAS")){
                    rbfatura1.setSelected(true);
                    tdias1.setText(String.valueOf(forma.getData()));
               }else{
                    if(forma.getFormafaturamento().equals("SEMPRE NO DIA")){
                         rbfatura2.setSelected(true);
                         tdias2.setText(String.valueOf(forma.getData()));
                    }
               }
          } 
          tadiantamento.setText(mas.ColocaVirgula(forma.getAdiantamento()));
          tjuro.setText(mas.ColocaVirgula(forma.getJuros()));
     }

     private void setaFormaPagamento() {
          forma.setNome(tnome.getText().toUpperCase());
          if(rbfatura1.isSelected() == true){
               forma.setFormafaturamento("A CADA TANTOS DIAS");
               forma.setData(Integer.valueOf(tdias1.getText()));
          }else{
               if(rbfatura2.isSelected() == true){
                    forma.setFormafaturamento("SEMPRE NO DIA");
                    forma.setData(Integer.valueOf(tdias2.getText()));
               }
          }
          forma.setJuros(mas.TiraVirgula(tjuro.getText()));
          forma.setAdiantamento(mas.TiraVirgula(tadiantamento.getText()));
     }
}
